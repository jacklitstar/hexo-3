---
title: 折腾小记
date: 2024-10-13 18:00:00
categories: Diary
---
# RTMP
昨天 2024年10月12日 和wzj折腾了一个RTMP服务，简单来说就是配置了一个软件。基于nginx反向代理实现直播推流和分发。他买的云服务器带宽只有3M，我这电脑有个30Mbps的ipv4的带宽和无限制的ipv6带宽。虽说不知道为啥ipv6一直配置不好很奇怪，所有服务中只有teamspeak能双栈访问。我端口配置的应该没有问题？还有就是发现非常奇怪的bug，虚拟机不能访问网络中其他的设备，只能访问10.0.0.1，但是不能访问10.0.0.2 。看了以下可能是vpn对路由表做了很奇怪的配置导致的，把10.0.0.0/24 给路由到了“在链路上”。这具体啥意思我也不知道。。。
anyway 用播放器访问 rtmp://example.com:port/live/streamname  应该就能看了。感觉这个方法并不是很elegant，没有鉴权也没有访问控制，emmmmmmm就很open。 实测校园网牛逼无限速推流上传能跑到200Mbps，没有试过更高的了，小小MacBook估计推不动，但是真的很牛逼。可怜的主机上传限速30Mbps所以就没啥办法了，我都不敢想象用校园网这速度搭建服务器有多爽，可惜不开放宿舍的ipv6，只有教学楼的wifi有ipv6。不知道有ipv6的话校园网认证还怎么办，做个NAT66？  
之后可能会转移到Docker上做一个网页啥的玩玩？todo_list ++

# truenas
同样是这几周更新了TrueNas Scale 的系统到 24.10支持了Docker，果断更新。以前的kubernates简直不是人用的，至少我是用不来的。带来的问题就是 
1. 旧的App的配置是通过kubernates的向导配置的，其中的各种挂载、权限都是别人设置好的，文件位置我都不知道在哪里，还有ACL也用着极其臃肿的一套系统，各种权限问题层出不穷。
2. 之前使用TrueCharts安装的App全部都没了，TrueCharts破防删库跑路也好还是TrueNas团队懒得对第三方应用做升级转换也罢，反正以前的一堆应用都没了。不过也好，可以使用新的Docker安装何乐而不为。
   
这样一来使用上Docker安装Portainer之后谁还会用TrueNas自带的那个App界面啊！建议官方直接把App那一栏跳转到Portainer算了。简单的配置一下Docker就能安装好更多得App。注意记得配置Docker的权限给要用的文件夹的ACL，要不然挂载节点会失败。还记得把用户加入Docker Group里面，给用户权限。

# ts3audiobot and neteasemusicapi
配置好Docker之后重新安装了teamspeak，不过之前用的sinusbot比较麻烦，需要自己上传音乐。这一世改用ts3audiobot，使用了大佬们编译好的 [image](https://hub.docker.com/r/ancieque/ts3audiobot) 外加网易云音乐api的plugin直接播放网易云的音乐，不用自己上传了很爽。不爽的是插件不能更新bot的头像显示歌曲封面。不知道哪里出的问题，据我测试api应该是好的。整个过程看了几个B站视频教程，不过他们都是用的整合懒人包在Windows系统上部署的，和Docker部署有一点点不一样不过大差不差，可以说几乎唯一的区别就在plugin的选择上了，这边选择了Linux版本的插件。（话说感觉Docker部署还要方便一点点）neteasecloudmusicapi更是简单，简直plug and play，Docker 部署一秒钟都不要。

# 零刻EQR6
前几天花￥1288 买了个 “零刻EQR6” 打算当这边房子的all in one。这边主要是有大电视所以打算买个能带动电视的。货到了之后装了Windows Server 2022。 为什么WinServer？因为总是要装Win的毕竟打算插在电视上，再用hyper-v做虚拟化。随后带来了折腾的痛点，便是这个AMD Ryzen 7735HS定位是消费级的，没法装核显驱动。AMD不允许server系统装消费级显卡的驱动。遂四处搜多找到一堆workaround试，最终在一个无声的[youtube视频](https://www.youtube.com/watch?v=hFf3-XHpkUI&ab_channel=LiteOS)里找到了解决办法。说实话现在的信息都太杂乱了，往往宝贵资源都出现在一些奇怪的地方，各种教程秘籍都藏在互联网的角落里，而纯文本信息更是full of shit。水文，搜索引擎傻逼推荐，AI瞎扯浪费时间等等。这种东西又太小众专业没法直接问AI很无奈。Anyway在打完显卡驱动之后发现什么WiFi驱动、蓝牙驱动啥的都要打。不过在那之前还是测试了一下连接电视的性能，发现能 4K 60fps 8bit RGB/YCbCr 4,4,2 但是不能开HDR。打开电视的AMD Freesync之后能开 4K 24fps 10bit HDR 4,4,4 但是延迟巨高而且只有24fps啊！后来经过简单搜索发现这个HDMI接口是HDMI 2.0的，不支持那么高的带宽。虽说之前知道有这么回事但确实没考虑周全是我的问题，于是对不住了零刻，京东退款走起。商家承认了30天试玩无理由退货于是便之间退货了。  
在Hyper-V上装openwrt的虚拟机也是第一次，搞半天都没搞好镜像，发现.img.gz → .img → .vhdx 折腾半天。hyper-v 二代虚拟机不支持 .vhd 格式的虚拟磁盘，在转换软件中需要注意啊！虚拟交换机网络配置看了几个不同的UP配置还不太一样，emmmmm等新机子到了之后再研究吧哈哈哈哈哈哈。  
退货之后买了贵300的 “极摩客M7”，这个CPU是R7 Pro 6850H 。 CPU差一点但是接口完全大满贯，看up主也是给出了非常推荐的评价就入了。这俩CPU性能释放应该也查不了多少就无所谓了，几乎是市面上有HDMI 2.1 的最便宜的一类迷你主机了。

# Others
吐槽一下ipv6的配置，不知道为啥可能是一些软件和ipv6的冲突，造成了很奇怪的结果，ipv6的流量总是不正确。一直没有理解Windows的ipv6地址机制，旧的地址deprecated了貌似就不能ping了？再就是那几个相对固定的较小的公网地址有是什么意思？我记得计网里面讲了一点，大致就是说旧的不用，用新的，固定的随时都能用。但是为啥我的用不了！！！总之就是一台电脑6个甚至更多的ip但是那个能用不知道？学术不精sorry  
再就是ipv6奇怪的防火墙？首先是VPN没法通过ipv6连接，只能走v4。但是v4有上传带宽限制，导致我其实很希望全面拥抱v6。可能是这个openwrt固件的问题？具体的就不知道，我也不敢更新固件，往往能更新出非常奇怪的bug天天断网。当时配置openwrt的时候几乎天天都会断网。

问移动运维要超级密码的时候是晚上很晚了，运维给了密码但是就是怎么都不对。运维人挺开朗的一直陪我试，后来发现是晚上十点之后超密20s更新一次，输进去对了20s改不完配置给你踢出来。这种防用户自己配置的机制太离谱了！只在上班时间能用的超级密码是吧！草。


